ambra:
  image: ambra:master
  links:
    - ambradb:ambradb
    - solr:solr
    - contentrepo:repo
  ports:
    - "80:8080"
  volumes:
    - ../../templates:/root/templates
    # - ../tests/test_data/sample_templates:/root/templates
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_USER=ambra
    - MYSQL_USER_PASSWORD=ambra
    - MYSQL_HOSTNAME=ambradb
    - MYSQL_DATABASE=ambra
    - REPO_SERVICE=http://repo:8080

wombat:
  image: wombat:master
  links:
    - rhino:rhino
    - contentrepo:repo
  volumes:
    - ../../plos-themes:/root/themes
  ports:
    - "8081:8080"
  environment:
    - RHINO_SERVICE=http://rhino:8080

rhino:
  image: rhino:master
  links:
    - ambradb:ambradb
    - contentrepo:repo
    - solr:solr
  ports:
    - "8080:8080"
  volumes:
    - $HOME/datastores/ingest:/root/ingest
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_USER=ambra
    - MYSQL_USER_PASSWORD=ambra
    - MYSQL_HOSTNAME=ambradb
    - MYSQL_DATABASE=ambra
    - REPO_SERVICE=http://repo:8080

ambradb:
  image: percona:5.6
  environment:
    - MYSQL_ROOT_PASSWORD=root
  ports:
    - "3306:3306"

solr:
  image: solr:master
  ports:
    - "8983:8080"
  volumes:
    - "$HOME/datastores/solr:/usr/local/tomcat/solr/home/data"

contentrepo:
  image: contentrepo:master
  links:
    - repodb
    - mogilenode
    - mogiletracker
  ports:
    - "8085:8080"
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_USER=repouser
    - MYSQL_USER_PASSWORD=
    - MYSQL_HOSTNAME=repodb
    - MYSQL_DATABASE=repo
    - MOGILE_TRACKERS=mogiletracker:7001

repodb:
  image: percona:5.6
  environment:
    - MYSQL_ROOT_PASSWORD=root
  ports:
    - "3305:3306"

mogiletracker:
  image: mogiletracker
  links:
    - mogiledb
    - mogilenode
  environment:
    - MYSQL_HOSTNAME=mogiledb
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_USER=mogile
    - MYSQL_USER_PASSWORD=mogile
    - MOG_NODE_HOST=mogilenode

mogilenode:
  image: mogilenode

mogiledb:
  image: percona:5.6
  environment:
    - MYSQL_ROOT_PASSWORD=root
